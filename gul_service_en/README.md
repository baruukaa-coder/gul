# gul_service — Flower Store Microservice (FastAPI + MongoDB Replica Set + NGINX)

This repository contains **gul_service**, a minimal flower store microservice built with **FastAPI** and structured using **Clean Architecture**.
It uses a MongoDB replica set (3 nodes) and an NGINX load balancer with two FastAPI instances. Authentication is intentionally omitted for simplicity.

## Features
- Clean Architecture (domain / usecase / infrastructure / adapters)
- CRUD for `Flower` entity
- MongoDB replica set (mongo1, mongo2, mongo3) with automated initialization
- NGINX load balancing across two FastAPI app instances
- Docker Compose to run the whole stack

## Entity: Flower
Fields:
- `id` (string) — generated by MongoDB
- `name` (string)
- `description` (string, optional)
- `price` (float)
- `stock` (int)
- `color` (string, optional)
- `created_at` (ISO datetime, set by service on create)

## Endpoints
- `POST   /flowers`        — create a flower
- `GET    /flowers`        — list flowers
- `GET    /flowers/{id}`   — get a flower by id
- `PUT    /flowers/{id}`   — update a flower
- `DELETE /flowers/{id}`   — delete a flower

## Quick start
1. Build and start containers:
```bash
docker compose build --no-cache
docker compose up
```
2. Wait ~20–40 seconds for MongoDB replica set initialization.
3. Open API docs: http://localhost:8080/docs

## Example curl
Create a flower:
```bash
curl -X POST "http://localhost:8080/flowers" -H "Content-Type: application/json" -d '{"name":"Rose","price":3.5,"stock":100,"color":"red","description":"Red rose"}'
```

List flowers:
```bash
curl "http://localhost:8080/flowers"
```

Get by id, update, delete similarly.

## Project layout
```
gul_service/
├── app/
│   ├── adapters/
│   │   ├── http/
│   │   │   └── flower_router.py
│   │   └── repo/
│   │       └── mongo_flower_repo.py
│   ├── domain/
│   │   ├── entities.py
│   │   └── repository.py
│   ├── infrastructure/
│   │   └── db.py
│   ├── usecase/
│   │   └── flower_service.py
│   ├── di.py
│   └── main.py
├── nginx/
│   ├── Dockerfile
│   └── nginx.conf
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
└── .env
```


